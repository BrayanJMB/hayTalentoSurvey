@model List<ProyectoIdentity.Controllers.Categorias>
@{
    ViewData["Title"] = "Home Page";
    var surveyId = Model.Select(x => x.surveyId).FirstOrDefault();
}

<div class="contenedor-imagen w-100">
    <img class="w-100" src="~/imagenes/ManosBeneficios.png" alt="Logo hay talento">
    <div class="contenedor-texto w-100 h-100 d-flex flex-column justify-content-between">
        <div class="d-flex align-items-center">
            <img style="max-width:150px" src="~/imagenes/LogoHayTalento.png" alt="Logo hay talento">
            <h1>@Model.Select(x=>x.Encuesta.NombreEncuesta).FirstOrDefault().Replace("Bienvenido a la","")</h1>
        </div>
        <h4>@DateTime.UtcNow.ToLocalTime()</h4>
    </div>
</div>
<div class="row">
    <h2 class="text-center">Dimensiones de los beneficios</h2>
    <canvas id="myChart"></canvas>
</div>

<div class="row d-flex justify-content-around">
    <h2 class="text-center">Dimensiones de los beneficios</h2>
    <div class="col-md-8">
        <canvas id="myChart2"></canvas>
    </div>
    <div class="col-2  d-flex flex-column justify-content-around">
        <div style="width:85%;">
            <canvas id="myChart3"></canvas>
            <div class="absolute-center text-center">
                <h5>Madurez</h5>
            </div>
        </div>
        <div style="width:85%;">
        <canvas id="myChart4"></canvas>
        <div class="absolute-center text-center">
            <h5>Total</h5>
        </div>
        </div>
    </div>
</div>

<div class="row mt-5">
    <div style="width:700px">
        <h2 class="text-center">Demograficos</h2>
        <canvas id="demograficos" width="800" height="600"></canvas>
    </div>
</div>

@Html.Partial("../Dashboard1/Index2", Model)

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="~/js/index.umd.js" asp-append-version="true"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2 "></script>


<script>
    var surveyId = @Model.Select(x=>x.surveyId).FirstOrDefault();
    window.onload = () => {
        $.ajax({
            url: 'DatosDemograficos/',
            type: 'POST',
            dataType: 'json',
            data: { surveyId: surveyId },
            success: function (data) {
                let promedioPorCategoria = 0;
                data.forEach(element => {
                    promedioPorCategoria += element.promedioGeneral;
                })

                //Datos para la encuesta de madurez
                $.ajax({
                    url: 'DatosMadurez/',
                    type: 'POST',
                    dataType: 'json',
                    data: { surveyId: surveyId + 1 },
                    success: function (dataMadurez) {
                        let promedioGeneral = 0;
                        dataMadurez.forEach(element => {
                            promedioPorCategoria += element.promedioGeneral;
                        })
                        promedioGeneral = promedioPorCategoria / (data.length + dataMadurez.length)

                        GraficaPromedioGeneral(data, dataMadurez, promedioGeneral);
                        GraficaPromedioGeneralBarras(data);
                        MadurezDoughnut(dataMadurez);
                        PromedioTotalDoughnut(promedioGeneral);
                    },
                    error: function (xhr, textStatus, errorThrown) {
                        // Se produjo un error al obtener los datos
                        console.log('Error al obtener los datos: ' + errorThrown);
                    }
                });

            },
            error: function (xhr, textStatus, errorThrown) {
                // Se produjo un error al obtener los datos
                console.log('Error al obtener los datos: ' + errorThrown);
            }
        });
    }
    //Registra plugin
    Chart.register(ChartDataLabels);
    function GraficaPromedioGeneral(data, dataMadurez, promedioGeneral) {
        console.log(dataMadurez)
        new Chart(document.getElementById("myChart"), {
            type: 'bubble',
            data: {
                datasets: [
                    {
                        label: `Madurez`,
                        backgroundColor: "rgba( 147, 147, 147,0.5)",
                        data: [{
                            x: 2,
                            y: 40,
                            r: 120
                        }]
                    },
                    {
                        label: `${dataMadurez[0].promedioGeneral.toFixed(1)}`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 2,
                            y: 35,
                            r: 5
                        }],
                        datalabels: {
                            color: 'black',
                            font: {
                                size: '20',
                                weight: 'bold'
                            }
                        }
                    },
                    //Contenido Herramiento de trabajo

                    {
                        label: `Herramientas \n     de trabajo`,
                        backgroundColor: "rgba(207,66,63,0.5)",
                        borderColor: "rgba(207,66,63,1)",
                        data: [{
                            x: 2.5,
                            y: 60,
                            r: 60
                        }]
                    },
                    {
                        label: `${data[3].promedioGeneral.toFixed(1)}`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 3.3,
                            y: 68,
                            r: 5
                        }],
                        datalabels: {
                            color: 'black',
                            font: {
                                size: '20',
                                weight: 'bold'
                            }
                        }
                    },
                    {
                        label: ` Paquete de mejoras extralegales \n que complementan el salario base, \n pueden ser monetarias o emocionales.`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 3.3,
                            y: 60,
                            r: 5
                        }]
                    },
                    //Contenido texto Calidad de vida
                    {
                        label: 'Calidad de vida',
                        backgroundColor: "rgba(77,179,199,0.5)",
                        borderColor: "rgba(77,179,199,1)",
                        data: [{
                            x: 1.5,
                            y: 60,
                            r: 60
                        }]
                    },
                    {
                        label: `${data[0].promedioGeneral.toFixed(1)}`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 0.8,
                            y: 68,
                            r: 5
                        }],
                        datalabels: {
                            color: 'black',
                            font: {
                                size: '20',
                                weight: 'bold'
                            }
                        }
                    },
                    {
                        label: ` Aspectos relacionados con las\n condiciones favorables en la relación\n laboral y el ambiente de trabajo.`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 0.7,
                            y: 60,
                            r: 60
                        }]
                    },
                    //Desarrollo
                    {
                        label: 'Desarrollo \n Personal',
                        backgroundColor: "rgba(29,110,155,0.5)",
                        borderColor: "rgba(29,110,155,1)",
                        data: [{
                            x: 1.5,
                            y: 20,
                            r: 60
                        }]
                    },
                    {
                        label: `${data[2].promedioGeneral.toFixed(1)}`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 0.7,
                            y: 28,
                            r: 5
                        }],
                        datalabels: {
                            color: 'black',
                            font: {
                                size: '20',
                                weight: 'bold'
                            }
                        }
                    },
                    {
                        label: `Acciones de largo plazo que apuestan\n por el crecimiento personal, potencializar\n el talento y transformar la organización.`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 0.7,
                            y: 20,
                            r: 50
                        }]
                    },
                    //Monetarios
                    {
                        label: '    Monetarios \n no monetarios',
                        backgroundColor: "rgba(244,157,0,0.6)",
                        borderColor: "rgba(244,157,0,1)",
                        data: [{
                            x: 2.5,
                            y: 20,
                            r: 60,
                        }]
                    },
                    {
                        label: `${data[1].promedioGeneral.toFixed(1)}`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 3.2,
                            y: 28,
                            r: 5
                        }],
                        datalabels: {
                            color: 'black',
                            font: {
                                size: '20',
                                weight: 'bold'
                            }
                        }
                    },
                    {
                        label: `Elementos útiles para una \nadecuada realización de la labor.`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 3.2,
                            y: 20,
                            r: 50
                        }]
                    },
                    //Total
                    {
                        label: 'Total',
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255,255,255,0.1)",
                        data: [{
                            x: 2,
                            y: 80,
                            r: 50,
                        }]
                    },
                    {
                        label: `${promedioGeneral.toFixed(1)}`,
                        backgroundColor: "rgba(255,255,255,0.1)",
                        borderColor: "rgba(255, 255,255,0.1)",
                        data: [{
                            x: 2,
                            y: 75,
                            r: 5
                        }],
                        datalabels: {
                            color: 'black',
                            font: {
                                size: '20',
                                weight: 'bold'
                            }
                        }
                    },
                ]
            },
            options: {
                responsive: true,
                maintainAspectRation: false,
                plugins: {
                    tooltip: {
                        display: false,
                        enabled: false
                    },
                    legend: {
                        display: false
                    },
                    datalabels: {
                        color: 'black',
                        formatter: (dp, ctx, b) => (ctx.dataset.label)
                    }
                },
                title: {
                    display: false
                },
                scales: {
                    y: {
                        min: 0,
                        max: 80,
                        display: false
                    },
                    x: {
                        min: 0,
                        max: 4,
                        display: false
                    }
                }
            }
        });
    }


    function GraficaPromedioGeneralBarras(datos) {
        const dimensionBeneficioBar = document.getElementById('myChart2');
        let datosPromedioPorCategoria = []
        datos.forEach(element => {
            datosPromedioPorCategoria.push(element.promedioGeneral.toFixed(1))
        })
        new Chart(dimensionBeneficioBar, {
            type: 'bar',
            data: {
                labels: ["Calidad de vida", "Monetarios no Monetarios", "Desarrollo Personal", "Herramientas Trabajo"],
                datasets: [
                    {
                        backgroundColor: ["rgba(77,179,199,1)", "rgba(246, 194, 100, 1)", "rgba(29,110,155,1)", "rgba(207, 66, 63, 1)"],
                        data: datosPromedioPorCategoria,
                    }
                ]
            },
            options: {
                barThickness: 80,
                scales: {
                    x: {
                        grid: {
                            display: false
                        }
                    },
                    y: {
                        grid: {
                            display: false
                        }
                    }
                },
                plugins: {
                    tooltip: {
                        display: false
                    },
                    legend: {
                        display: false
                    },
                    datalabels: {
                        color: '#FFFFFF',
                        offset: 4,
                        font: {
                            weight: 'bold'
                        }
                    }
                }
            }
        });
    }

    function MadurezDoughnut(datosMadurez) {
        const dimensionBeneficioBar2 = document.getElementById('myChart3');
        new Chart(dimensionBeneficioBar2, {
            type: 'doughnut',
            data: {
                labels: ['Promedio Madurez'],
                datasets: [
                    {
                        label: 'Madurez',
                        backgroundColor: ["rgba(62, 149, 205, 1)", "rgba(30, 30, 30, 0.5)"],
                        data: [datosMadurez[0].promedioGeneral.toFixed(1), 5 - datosMadurez[0].promedioGeneral.toFixed(1)],
                        datalabels: {
                            color: 'white',
                            font: {
                                weight: 'bold'
                            }
                        }
                    }
                ]
            },
            options: {
                cutout: '60%',
                plugins: {
                    tooltip: {
                        display: false
                    },
                    legend: {
                        display: false
                    }
                }
            }
        });
    }

    function PromedioTotalDoughnut(promedioGeneral) {
        new Chart(dimensionBeneficioBar3, {
            type: 'doughnut',
            data: {
                labels: ['Promedio General'],
                datasets: [
                    {
                        label: 'Total',
                        backgroundColor: ["rgba(62, 149, 205, 1)", "rgba(30, 30, 30, .5)"],
                        data: [promedioGeneral.toFixed(1), (5 - promedioGeneral).toFixed(1)],
                        datalabels: {
                            color: 'white',
                            font: {
                                weight: 'bold'
                            }
                        }
                    }
                ]
            },
            options: {
                cutout: '60%',
                plugins: {

                    tooltip: {
                        display: false
                    },
                    legend: {
                        display: false
                    },
                }
            }

        });
    }

    const demografico = document.getElementById('demograficos');
    new Chart(demografico, {
        type: 'pie',
        data: {
            labels: ['Sexo', 'EstadoCivil', 'NivelEducativo', 'Dependencia Economica', 'Edad'],
            datasets: [
                {
                    data: [30, 20],
                    backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#FFCE90', '#AACE56']
                },
                {
                    data: [20, 40],
                    backgroundColor: ['#FF8F8F', '#66C2A5', '#FFD28F', '#FFDD11', '#CCCE23']
                },
                {
                    data: [20, 40],
                    backgroundColor: ['#FF8F8F', '#66C2A5', '#FFD28F', '#FFDD11', '#CCCE23']
                }
            ]
        },
        options: {
            title: {
                display: true,
                text: 'Gráfica de Multi Series Pie'
            }
        }
    });
    const dimensionBeneficioBar3 = document.getElementById('myChart4');
</script>